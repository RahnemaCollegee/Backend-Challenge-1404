## سوال SQL: تحلیل سفارش‌ها (۱۰۰ امتیاز)

در این سوال، شما با یک پایگاه داده فروش آنلاین سر و کار دارید. جداولی که در اختیار دارید به شرح زیر هستند:

---

### جدول `users`

| فیلد       | نوع داده  | توضیحات                  |
| ---------- | --------- | ------------------------ |
| id         | INTEGER   | شناسه یکتا برای هر کاربر |
| name       | TEXT      | نام کاربر                |
| created_at | TIMESTAMP | زمان ثبت‌نام کاربر       |

---

### جدول `orders`

| فیلد        | نوع داده  | توضیحات                  |
| ----------- | --------- | ------------------------ |
| id          | INTEGER   | شناسه یکتا برای هر سفارش |
| user_id     | INTEGER   | شناسه کاربر سفارش‌دهنده  |
| total_price | INTEGER   | مبلغ کل سفارش (تومان)    |
| created_at  | TIMESTAMP | زمان ثبت سفارش           |

---

### بخش اول: پرخرج‌ترین کاربران

کوئری بنویسید که **۵ کاربر اول** را بر اساس **مجموع مبلغ سفارش‌هایشان** به صورت نزولی برگرداند.

<br/>

### بخش دوم: کاربران بدون سفارش

لیستی از کاربرانی که **تا کنون هیچ سفارشی ثبت نکرده‌اند** استخراج کنید.

<br/>

### بخش سوم: میانگین سفارش ماهانه

برای هر ماه در سال ۲۰۲۳، میانگین مبلغ سفارش‌ها را به دست آورید. خروجی باید شامل ماه و میانگین آن باشد. (مثلاً: "2023-05" و میانگین آن)

<br/>

### بخش چهارم: کاربران جدید با سفارش اول بالا

کاربرانی را که در **۳ ماه گذشته** ثبت‌نام کرده‌اند و **اولین سفارششان** مبلغی بیشتر از ۵۰۰٬۰۰۰ تومان داشته است، پیدا کنید.

<br/>

### محدودیت‌ها

<div dir="rtl">
<li>از توابع SQL استاندارد استفاده کنید.</li>
<li>می‌توانید از CTE، window functions و زیردرخواست‌ها استفاده کنید.</li>
<li>برای راحتی، فرض کنید زمان‌ها به صورت استاندارد و در یک timezone ثبت شده‌اند.</li>
</div>

<br/>
